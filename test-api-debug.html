<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug API Test</title>
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Debug API Test</h1>
        
        <div class="row">
            <div class="col-md-6">
                <h3>Test Endpoints</h3>
                <button onclick="testEndpoint()" class="btn btn-primary mb-3">Test Basic Endpoint</button>
                <button onclick="testCreateFreeAccess()" class="btn btn-success mb-3">Test Create Free Access Simple</button>
                <button onclick="testCreateFreeAccessMain()" class="btn btn-warning mb-3">Test Create Free Access Main</button>
                <div id="results" class="border p-3" style="min-height: 200px; background: #f8f9fa;">
                    <em>Results will appear here...</em>
                </div>
            </div>
            
            <div class="col-md-6">
                <h3>Current Info</h3>
                <div class="card">
                    <div class="card-body">
                        <p><strong>Base URL:</strong> <span id="baseUrl"></span></p>
                        <p><strong>Current Time:</strong> <span id="currentTime"></span></p>
                        <p><strong>User Agent:</strong> <span id="userAgent"></span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Update current info
        document.getElementById('baseUrl').textContent = window.location.origin + window.location.pathname.replace('/test-api-debug.html', '');
        document.getElementById('currentTime').textContent = new Date().toLocaleString();
        document.getElementById('userAgent').textContent = navigator.userAgent;

        async function testEndpoint() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="text-info">Testing basic endpoint...</div>';
            
            try {
                const response = await fetch('api/services/test-endpoint.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ test: 'data' })
                });
                
                const text = await response.text();
                
                resultsDiv.innerHTML = `
                    <h5>✅ Basic Endpoint Test</h5>
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>Response:</strong></p>
                    <pre style="background: #fff; padding: 10px; border: 1px solid #ddd;">${text}</pre>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <h5>❌ Basic Endpoint Error</h5>
                    <p><strong>Error:</strong> ${error.message}</p>
                `;
            }
        }

        async function testCreateFreeAccess() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="text-info">Testing create free access endpoint...</div>';
            
            try {
                // Test simple version first
                const response = await fetch('api/services/create-free-access-simple.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ package_id: 1 })
                });
                
                const text = await response.text();
                
                resultsDiv.innerHTML = `
                    <h5>✅ Create Free Access Simple Test</h5>
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>Response:</strong></p>
                    <pre style="background: #fff; padding: 10px; border: 1px solid #ddd;">${text}</pre>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <h5>❌ Create Free Access Error</h5>
                    <p><strong>Error:</strong> ${error.message}</p>
                `;
            }
        }

        async function testCreateFreeAccessMain() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="text-info">Testing main create free access endpoint...</div>';
            
            try {
                const response = await fetch('api/services/create-free-access.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ package_id: 1 })
                });
                
                const text = await response.text();
                
                resultsDiv.innerHTML = `
                    <h5>✅ Create Free Access Main Test</h5>
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>Response:</strong></p>
                    <pre style="background: #fff; padding: 10px; border: 1px solid #ddd;">${text}</pre>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <h5>❌ Create Free Access Main Error</h5>
                    <p><strong>Error:</strong> ${error.message}</p>
                `;
            }
        }
    </script>
</body>
</html>