<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Đăng Nhập - PAC Group</title>
  <meta content="Đăng nhập để truy cập hệ thống tư vấn giáo dục PAC Group" name="description">
  <meta content="đăng nhập, PAC Group, giáo dục, tư vấn" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">

  <!-- Toastbar CSS -->
  <link href="assets/css/toastbar.css?v=20112025" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/main.css?v=20112025" rel="stylesheet">
  
  <!-- Access Pages CSS File -->
  <link href="assets/css/access.css?v=20112025" rel="stylesheet">

  <!-- Early Authentication Check - Before page renders -->
  <style>
    /* Fullscreen loading overlay */
    #authLoadingOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      color: white;
      font-family: 'Roboto', sans-serif;
    }
    
    .auth-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .auth-loading-text {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 10px;
    }
    
    .auth-loading-subtitle {
      font-size: 14px;
      opacity: 0.8;
    }
  </style>
  
  <script>
    // Inject fullscreen loading overlay immediately
    document.write(`
      <div id="authLoadingOverlay">
        <div class="auth-spinner"></div>
        <div class="auth-loading-text">Đang kiểm tra đăng nhập</div>
        <div class="auth-loading-subtitle">Vui lòng chờ trong giây lát...</div>
      </div>
    `);
    
    // Quick authentication check using cookies only
    function quickAuthCheck() {
      // Get pac_user_info cookie
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) {
          return parts.pop().split(';').shift();
        }
        return null;
      }
      
      try {
        const userInfoCookie = getCookie('pac_user_info');
        if (userInfoCookie) {
          // User appears to be logged in, redirect immediately
          window.location.href = 'home';
          return true;
        }
      } catch (error) {
        console.error('[Login Early Check] Error:', error);
      }
      return false;
    }
    
    // Run quick check immediately
    quickAuthCheck();
  </script>
</head>

<body class="auth-page">
  <!-- Login Container -->
  <div class="auth-container">
    
    <!-- Left Side - Illustration -->
    <div class="auth-image">
      <div class="auth-illustration">
        <i class="fas fa-graduation-cap"></i>
        <h3>Unlock your Career</h3>
        <p>Kết nối cùng chúng tôi <br> Chọn đúng nghề, học đúng ngành</p>
      </div>
    </div>

    <!-- Right Side - Login Form -->
    <div class="auth-form-section">
      <div class="auth-header">
        <h2>Đăng Nhập</h2>
        <p>Vui lòng nhập thông tin đăng nhập của bạn</p>
      </div>

      <div id="authForm" class="auth-form">
        <div class="form-group">
          <label for="username">Tên đăng nhập *</label>
          <input type="text" class="form-control" id="username" name="username" placeholder="Nhập tên đăng nhập của bạn" required>
        </div>

        <div class="form-group">
          <label for="password">Mật khẩu *</label>
          <input type="password" class="form-control" id="password" name="password" placeholder="Nhập mật khẩu của bạn" required>
        </div>

        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="remember" name="remember">
          <label class="form-check-label" for="remember">
            Ghi nhớ đăng nhập
          </label>
        </div>

        <button type="button" class="btn-auth" id="authButton">Đăng Nhập</button>

        <div class="auth-footer">
          <p><a href="#" id="forgotPassword">Quên mật khẩu?</a></p>
          <p>Chưa có tài khoản? <a href="dangky">Đăng ký ngay</a></p>
        </div>
      </div>
    </div>

    <!-- Back to Home Button -->
    <div class="auth-actions">
      <a href="home" class="back-home-btn">
        <i class="fas fa-arrow-left"></i> Quay về trang chủ
      </a>
    </div>
  </div>

  <!-- Scripts -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/js/toastbar.js?v=20112025"></script>
  <script src="assets/js/authen.js?v=20112025"></script>
  <script src="assets/js/access.js?v=20112025"></script>
  
  <!-- Initialize Login Page -->
  <script>
    // Function to hide loading overlay (if still showing)
    function hideLoadingOverlay() {
      const overlay = document.getElementById('authLoadingOverlay');
      if (overlay) {
        overlay.style.opacity = '0';
        overlay.style.transition = 'opacity 0.3s ease';
        setTimeout(() => {
          overlay.remove();
        }, 300);
      }
    }

    // Enhanced authentication check after DOM loads (if user wasn't redirected by early check)
    document.addEventListener('DOMContentLoaded', async function() {
        try {
            // Show loading state on form elements
            const authForm = document.getElementById('authForm');
            const authButton = document.getElementById('authButton');
            
            if (authForm) {
                authForm.style.opacity = '0.7';
            }
            if (authButton) {
                authButton.disabled = true;
                authButton.textContent = 'Đang kiểm tra...';
            }
            
            // Do server verification (early check only used cookies)
            const isAlreadyAuthenticated = await authChecker.handleAuthPageAccess('login');
            
            if (!isAlreadyAuthenticated) {
                // User is not authenticated, show the login form
                if (authForm) {
                    authForm.style.opacity = '1';
                }
                if (authButton) {
                    authButton.disabled = false;
                    authButton.textContent = 'Đăng Nhập';
                }
                
                // Hide loading overlay
                hideLoadingOverlay();
                
                // Initialize auth page
                if (typeof AuthHelpers !== 'undefined') {
                    AuthHelpers.init('login');
                } else {
                    console.error('[Login Page] AuthHelpers not found. Please check access.js');
                }
            }
            // If user is authenticated, redirect should happen
            
        } catch (error) {
            console.error('[Login Page] Error during login page initialization:', error);
            
            // Restore form state on error
            const authForm = document.getElementById('authForm');
            const authButton = document.getElementById('authButton');
            
            if (authForm) {
                authForm.style.opacity = '1';
            }
            if (authButton) {
                authButton.disabled = false;
                authButton.textContent = 'Đăng Nhập';
            }
            
            // Hide loading overlay
            hideLoadingOverlay();
            
            // Initialize auth page as fallback
            if (typeof AuthHelpers !== 'undefined') {
                AuthHelpers.init('login');
            }
        }
    });

    // Check if we need to hide loading overlay after timeout
    setTimeout(() => {
      // If loading overlay is still visible after 2 seconds, hide it
      const overlay = document.getElementById('authLoadingOverlay');
      if (overlay && !window.location.href.includes('home')) {
        hideLoadingOverlay();
      }
    }, 2000);
  </script>
</body>
</html>
