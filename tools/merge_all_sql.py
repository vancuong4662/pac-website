"""
Script ƒë·ªÉ g·ªôp c√°c file SQL quan tr·ªçng th√†nh file one-shot.sql
Th·ª© t·ª±: create-all-tables.sql -> sample-data.sql -> questions-and-quiz.sql -> jobs_data_insertion.sql
"""

import os
from pathlib import Path

# ƒê∆∞·ªùng d·∫´n t∆∞∆°ng ƒë·ªëi
SCRIPT_DIR = Path(__file__).parent
PROJECT_ROOT = SCRIPT_DIR.parent
SQL_DIR = PROJECT_ROOT / "sql"
OUTPUT_FILE = SQL_DIR / "one-shot.sql"

# Danh s√°ch file SQL c·∫ßn g·ªôp theo th·ª© t·ª±
SQL_FILES = [
    "create-all-tables.sql",
    "sample-data.sql",
    "questions-and-quiz.sql",
    "jobs_data_insertion.sql"
]

def read_sql_file(file_path):
    """ƒê·ªçc n·ªôi dung file SQL"""
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        return content
    except Exception as e:
        print(f"‚ùå L·ªói khi ƒë·ªçc file {file_path}: {e}")
        return None

def merge_sql_files():
    """G·ªôp c√°c file SQL th√†nh m·ªôt file duy nh·∫•t"""
    print("üîÑ B·∫Øt ƒë·∫ßu g·ªôp c√°c file SQL...")
    print(f"üìÅ Th∆∞ m·ª•c SQL: {SQL_DIR}")
    print(f"üìù File output: {OUTPUT_FILE}")
    print("-" * 60)
    
    merged_content = []
    
    # Header cho file output
    merged_content.append("-- =========================================")
    merged_content.append("-- ONE-SHOT SQL DEPLOYMENT SCRIPT")
    merged_content.append("-- Auto-generated by merge_all_sql.py")
    merged_content.append("-- =========================================")
    merged_content.append("")
    
    # G·ªôp t·ª´ng file
    for sql_file in SQL_FILES:
        file_path = SQL_DIR / sql_file
        
        if not file_path.exists():
            print(f"‚ö†Ô∏è  File kh√¥ng t·ªìn t·∫°i: {sql_file}")
            continue
        
        print(f"‚úÖ ƒê·ªçc file: {sql_file}")
        content = read_sql_file(file_path)
        
        if content:
            # Th√™m separator v√† t√™n file
            merged_content.append(f"\n-- =========================================")
            merged_content.append(f"-- SOURCE: {sql_file}")
            merged_content.append(f"-- =========================================\n")
            merged_content.append(content)
            merged_content.append("\n")
    
    # Ghi ra file output
    try:
        with open(OUTPUT_FILE, 'w', encoding='utf-8') as f:
            f.write('\n'.join(merged_content))
        
        print("-" * 60)
        print(f"‚úÖ ƒê√£ t·∫°o file {OUTPUT_FILE.name} th√†nh c√¥ng!")
        print(f"üìä T·ªïng k√≠ch th∆∞·ªõc: {OUTPUT_FILE.stat().st_size:,} bytes")
        
    except Exception as e:
        print(f"‚ùå L·ªói khi ghi file output: {e}")
        return False
    
    return True

if __name__ == "__main__":
    print("\n" + "=" * 60)
    print("  MERGE SQL FILES - PAC WEBSITE DEPLOYMENT")
    print("=" * 60 + "\n")
    
    success = merge_sql_files()
    
    print("\n" + "=" * 60)
    if success:
        print("  ‚úÖ HO√ÄN T·∫§T!")
    else:
        print("  ‚ùå C√ì L·ªñI X·∫¢Y RA!")
    print("=" * 60 + "\n")
